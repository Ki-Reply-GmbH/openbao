name: Set up gocovmerge
description: Install gocovmerge binary

inputs:
  destination:
    description: "Where to install the gocovmerge binary (default: $HOME/bin)"
    default: "$HOME/bin"
  version:
    description: "The gocovmerge version tag to install (e.g. v1.0.0)"
    default: latest

outputs:
  destination:
    description: Where the gocovmerge binary is
    value: ${{ steps.install.outputs.destination }}
  version:
    description: The installed version
    value: ${{ steps.install.outputs.version }}

runs:
  using: composite
  steps:
    - id: install
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        mkdir -p "$HOME/bin"
        DEST="$HOME/bin/gocovmerge"
        echo "destination=$DEST" >> "$GITHUB_OUTPUT"

        # Use latest commit SHA since gocovmerge doesn't use releases
        echo "version=latest" >> "$GITHUB_OUTPUT"

        go install github.com/wadey/gocovmerge@latest
        echo "$(go env GOPATH)/bin" >> "$GITHUB_PATH"
